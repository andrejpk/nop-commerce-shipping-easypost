@model ConfigurationModel

@{
    Layout = "_ConfigurePlugin";
}

<form asp-controller="EasyPost" asp-action="Configure" method="post">
    <div class="cards-group">

        <partial name="_Credentials" model="Model" />

        @if (!string.IsNullOrEmpty(Model.ApiKey))
        {
            <partial name="_Carriers" model="Model" />
        }

        <partial name="_AddressVerification" model="Model" />

        @if (!string.IsNullOrEmpty(Model.ApiKey) || !string.IsNullOrEmpty(Model.TestApiKey))
        {
            <partial name="_ServiceConfiguration" model="Model" />
        }

        <div class="form-group row">
            <div class="col-md-9 offset-md-3">
                <button type="submit" name="save" class="btn btn-primary">@T("Admin.Common.Save")</button>
            </div>
        </div>

    </div>
</form>

@section scripts {
    <script src="~/Plugins/Shipping.EasyPost/js/pattern-matcher.js"></script>
    <script src="~/Plugins/Shipping.EasyPost/js/rule-manager.js"></script>
    <script src="~/Plugins/Shipping.EasyPost/js/service-discovery.js"></script>
    <script>
        // Initialize configuration with server-side data
        window.EasyPostConfig = {
            discoveredServices: @Html.Raw(Json.Serialize(Model.DiscoveredServices)),
            serviceDisplayRules: @Html.Raw(Json.Serialize(Model.ServiceDisplayRules)),
            urls: {
                discoverServices: '@Url.Action("DiscoverServices", "EasyPost")'
            }
        };
    </script>
}
